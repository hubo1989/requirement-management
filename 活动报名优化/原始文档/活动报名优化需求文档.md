# 活动报名优化需求文档

## 1. 需求概述

优化活动报名流程，调用活动报名接口前，对指定银行活动id的通过银行接口进行校验，校验通过后再调用报名接口。另外在报名时使用通过活动id与拓客行号关联到的最小颗粒度（网点、支行等），作为报名的关联银行ID。

## 2. 需求背景

当前活动报名流程存在以下问题：
- 缺少对银行活动有效性的校验机制
- 报名信息与银行机构的关联不够精确
- 可能导致无效报名或数据不一致的情况

## 3. 功能需求

### 3.1 银行活动ID校验

#### 3.1.1 校验流程
1. 用户提交活动报名请求
2. 系统获取活动ID和用户信息
3. 调用银行接口进行活动ID校验
4. 根据银行接口返回结果决定是否继续报名流程

#### 3.1.2 银行接口调用
- **接口名称**：苏州分行接口平台接口文档-"一行一市"项目卡号校验接口
- **接口文档**：[苏州分行接口平台接口文档-“一行一市”项目卡号校验接口.docx](./相关资源/苏州分行接口平台接口文档-“一行一市”项目卡号校验接口.docx)
- **调用方式**：待定（需根据接口文档确定）
- **请求参数**：
  - 活动ID
  - 用户身份信息
  - 其他必要参数（根据接口文档确定）
- **响应参数**：
  - 校验结果（成功/失败）
  - 活动状态信息
  - 其他相关信息（根据接口文档确定）

#### 3.1.3 校验判断逻辑
- **校验成功**：继续执行报名流程
- **校验失败**：向用户返回失败原因，终止报名流程
- **接口异常**：记录错误日志，向用户返回系统异常提示

### 3.2 银行机构关联优化

#### 3.2.1 最小颗粒度关联
- 根据活动ID与拓客行号的关联关系，确定最小颗粒度的银行机构（网点、支行等）
- 将最小颗粒度机构ID作为报名的关联银行ID
- 确保报名数据与银行机构精确对应

#### 3.2.2 数据映射
- 建立活动ID与银行机构的映射关系表
- 实现拓客行号到最小颗粒度机构的转换逻辑
- 维护机构层级关系数据

## 4. 技术实现方案

### 4.1 系统架构
- 在现有报名流程中增加银行接口校验环节
- 设计银行机构映射模块
- 实现最小颗粒度机构匹配算法

### 4.2 接口设计
- 设计银行接口调用模块
- 实现接口参数封装和响应解析
- 添加接口异常处理机制

### 4.3 数据库设计
- 活动与银行机构关联表
- 银行机构层级关系表
- 报名记录扩展表（增加最小颗粒度机构ID字段）

## 5. 非功能性需求

### 5.1 性能要求
- 银行接口调用响应时间不超过3秒
- 整体报名流程增加的时间不超过5秒

### 5.2 可靠性要求
- 银行接口调用失败重试机制
- 接口异常时的降级处理方案
- 关键数据备份和恢复机制

### 5.3 安全要求
- 银行接口调用安全性保障
- 敏感信息加密传输
- 操作日志记录和审计

## 6. 测试方案

### 6.1 功能测试
- 银行接口正常调用测试
- 校验成功/失败场景测试
- 最小颗粒度机构关联测试

### 6.2 异常测试
- 银行接口超时测试
- 接口返回异常数据测试
- 网络异常情况测试

### 6.3 性能测试
- 高并发报名场景测试
- 接口响应时间测试
- 系统资源占用测试

## 7. 上线计划

### 7.1 上线步骤
1. 开发环境功能实现和测试
2. 测试环境联调测试
3. 预生产环境验证
4. 生产环境灰度发布
5. 全量上线

### 7.2 风险控制
- 上线前数据备份
- 回滚方案准备
- 监控和告警机制

## 8. 验收标准

- [ ] 银行接口校验功能正常工作
- [ ] 最小颗粒度机构关联准确
- [ ] 报名流程整体性能满足要求
- [ ] 异常情况处理完善
- [ ] 测试用例全部通过

## 9. 相关文档

- [苏州分行接口平台接口文档-“一行一市”项目卡号校验接口.docx](./相关资源/苏州分行接口平台接口文档-“一行一市”项目卡号校验接口.docx)
- [活动报名接口文档](./相关资源/活动报名接口文档.md)
- [银行机构数据结构说明](./相关资源/银行机构数据结构说明.md)