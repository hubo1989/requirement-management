**苏州分行接口平台接口文档**

## 一、主要业务流程简介

接口平台主要是通过配置化的方式，编写SQL脚本，动态生成业务接口，实现与我行业务部门程序数据交接、传输。缩短业务相应时间，所有接口请求访问分成两大步骤，第一步：通过用户登录接口，获取有效token值；第二步：根据业务需要，请求业务接口，且每一次请求需要携带token，服务器才能返回所需业务数据。

内外网，开发生产请求地址

`内网生产：http://21.164.4.151:8080/apiplatform/*`

`内网开发：http://22.164.8.214:8080/apiplatform/*`

`外网生产：https://cloud.bankofchina.com/su/apiplatform/*`

`外网开发：https://cloud.bankofchina.com/su/beta/gws/apiplatform/*`

## 二、登录模块

1、名词解释

此模块只要包含用户登录接口，旨在认证用户信息。为保证业务数据、用户认证信息安全和便于描述，需要对相关概念做如下解释：

针对认证用户，用户在注册时区分为内网环境用户和外网环境用户，所谓内网环境用户即用户部署项目在我行生产网站或云平台服务器中。外网环境用户即为项目部署在非我行网络环境的应用。

内、外网环境用户在认证的网络接口也存在不同，且方案安全级别也存在差异。

2、认证接口

`内网环境用户认证接口为：`

`http://21.164.4.151:8080/apiplatform/manage/userLogin/login.action`

`请求方式为POST，相关参数为{"loginName":"user01","loginPass":"pass01"};`

`外网环境用户认证接口为:`

`https://cloud.bankofchina.com/su/apiplatform/manage/userLogin/programLogin.action`

`请求方式为POST,`
`相关参数为{"loginName":"user01","loginPass":"pass01"};此外，在进行相关请求时需要将用户的密码采用AES加密算法生成密文传输，获取加密结果。此外，外网环境用户在1小时内，请求认证接口次数不能超过10次，超过则用户锁定24小时，无法使用。`

请注意：内、外网环境用户无法在彼此接口登录，且内外网认证接口只在内外网环境中有效。

3、加密样例，选择苏州中行提供的加密算法BocPwdTool.jar，对数据进行加解密

`import com.bocsz.PwdEncryption;`

`public class Test {`

`public static void main(String[] args) throws Exception {`

`/**`

`* 用户登录加密功能,采用对称加密算法，密钥私下给出`

`**/`

`//明文数据`

`String loginPwd = "this is login test";`

`//密钥`

`String loginKey = "bocsz";`

`//加密处理`

`String encryptionContent = PwdEncryption.aesEncode(loginKey,loginPwd);`

`System.out.println("加密后字符串："+encryptionContent);`

`//解密处理`

`String decryptionContent =`
`PwdEncryption.aesDncode(loginKey,encryptionContent);`

`System.out.println("解密后字符串："+decryptionContent);`

`}`

`}`

4、返回结果以及解释

```
{  
	"code": 200,
	"success": true,
	"message": "用户登录成功",
	"data": {
	    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIxNjA4MDgwNTk6Q09NUFVURVIiLCJpYXQiOjE2MDEwMjE2MjIsImV4cCI6MTYwMTAyNTIyMn0.qYkGZIxmzhkDlL9M2r5xQ5_na_XeeD804Mke6uO902vG5FRNxhS3C8JLYYXj21r9n25qA97pJwQJvWc-mhSLog"
	  }
}
```

| 字段    | 名称     | 类型    | 值                          |
| ------- | -------- | ------- | --------------------------- |
| code    | 状态码   | Int     | 200/400/401/402/403/404/500 |
| success | 成功标识 | Boolean | True/false                  |
| message | 消息提示 | String  | String                      |
| data    | 结果     | Object  | 相关结果                    |

## 三、业务模块

1. 模块介绍

业务接口由SQL配置动态生成接口，业务访问存在用户权限控制。一个用户可以访问多个业务接口，一个业务接口可以由多个用户访问，每个用户在访问每一个接口都可以设置返回结果类型是JSON还是XML，也可选择返回数据是否需要进行加密或不加密，选择加密，将给相关解密算法与密钥，从而保证数据的安全性。

2. 接口样例

`内网环境接口URL：`

`http://21.164.4.151:8080/apiplatform/api/list/mobList.action?MOBILE=18913117895`

`外网环境接口`

`https://cloud.bankofchina.com/su/prod/apiplatform/api/list/mobList.action?MOBILE=18913117895`

`请求接口请求方式为GET，在请求header中添加token，值是获取登录接口的token值`

返回样例

不加密JSON返回结果：

```
{

  "code": 200,

  "success": true,

  "message": "列表查询成功",

  "total": 1,

  "data": [

    {

    "CUST_OR": "1",

    "CUST_NEW": "0",

    "TRAN_F": "1",

    "MOBILE": "18913117895",

    "ROW_ID": 1

    }

  ]

}
```

加密JSON返回结果：

```
{
  "code": 200,
  "success": true,
  "message": "列表查询成功",
  "total": 1,
  "data": [
    "ERNf/Klryl4Z57GtDAggmCUIiYt0qUUbXuRntvsMBj0foH6BaWq5fa0Be2uzchMsEqzcJhGaiCQqyLaiV4XJKQ=="
  ]
}
```

不加密XML返回结果：

```
<Result>
    <code>200</code>
    <success>true</success>
    <message>记录查询成功</message>
    <data>
        <STUDENT_AGE>19</STUDENT_AGE>
        <STUDENT_SEX>女</STUDENT_SEX>
        <STUDENT_CLASS>011</STUDENT_CLASS>
        <STUDENT_ID>2</STUDENT_ID>
        <STUDENT_NAME>赵敏</STUDENT_NAME>
        <STUDENT_PHONE>13815915742</STUDENT_PHONE>
    </data>
</Result>
```

加密XML返回结果：

```
<Result>
    <code>200</code>
    <success>true</success>
    <message>记录查询成功</message>
    <data>96YwNveCQq5D30rQsyHPMpFXcf2US7HY0bbc3xZ+LrjqTIWSBAEzyb7w1k3Hp4g8D/FM9RONgCEsUwfHkzFAawnthDuJ+7px9KZGVAnXXwvo2N7RQ96dqMpWzJZ+JNxa1SVv/dWFVGrqigzHKep05Kb6A9cc3+3mwyVYB18l4tWd6TvR1IOgx2dBsUY3gm6u</data>
</Result>
```

解密后为JSON字符串，具体字段含义需咨询接口配置人员。

3. 结果解释

结果加密算法存在三种方式，对称加密、非对称加密和混合加密三种，对称加密采用AES算法、非对称加密采用RSA算法，混合加密即通过对数据进行对称加密，将对称加密的密钥进行非对称加密，对外提供加密后的密钥和私钥，具体密钥需向接口配置人员索取。

XML形式业务数据解密的格式外JSON字符串，由于数据结果简单明了，因此不转换为XML格式。

4. **本次接口相关参数**

   1、认证接口参数

   用户名：lakala，

   密码:Password@01!

   2、业务接口参数

   业务接口URL：api/list/lakala_yhys.action，

   请求方式：get，

   请求参数为CARDNO，

   返回结果：json，

   结果加密算法：AES，

   密钥：ZGJiYWE2OGEtNmE2Mi00M2U0LWIxOWMtNDQzODJjY2NhNWEx

   3、接口返回

不加密JSON返回结果：

```
{
  "code": 200,
  "success": true,
  "message": "列表查询成功",
  "total": 1,
  "data": [
    {
      "FLAG": "1"  --1表示符合准入条件客户，不是返回0
      "ROW_ID": 1
    }
  ]
}
```

测试数据以及返回结果：

\--6217876101003321610 '0'

\--6217856101002453731 '1'

\--6216616101010690145 '0'
